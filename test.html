<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        background: #f4f4f4;
        width: 100%;
        height: 100%;
      }
      .noise {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
      }
      .noise::after {
        content: "";
        position: absolute;
        top: -10rem;
        left: -10rem;
        width: calc(100% + 20rem);
        height: calc(100% + 20rem);
        background-image: url(./src/img/noise.e8298e81.png);
        background-position: 50%;
        background-repeat: repeat;
        background-size: 300px;
      }
      @keyframes noise_noise__N0mbn {
        0% {
          transform: translate3d(0, 9rem, 0);
        }

        10% {
          transform: translate3d(-1rem, -4rem, 0);
        }

        20% {
          transform: translate3d(-8rem, 2rem, 0);
        }

        30% {
          transform: translate3d(9rem, -9rem, 0);
        }

        40% {
          transform: translate3d(-2rem, 7rem, 0);
        }

        50% {
          transform: translate3d(-9rem, -4rem, 0);
        }

        60% {
          transform: translate3d(2rem, 6rem, 0);
        }

        70% {
          transform: translate3d(7rem, -8rem, 0);
        }

        80% {
          transform: translate3d(-9rem, 1rem, 0);
        }

        90% {
          transform: translate3d(6rem, -5rem, 0);
        }

        to {
          transform: translate3d(-7rem, 0, 0);
        }
      }
      #sticker_canvas {
        position: relative;
        width: 100%;
        height: 100vh;
        background: #f7f7f7;
        overflow: hidden;
      }

      .note {
        position: absolute;
        width: 300px;
        height: 100px;
        background: #c9f100;
        /* border: 1px solid #000000; */
        box-shadow: 2px 2px 1px rgba(0, 0, 0, 0.2);
        padding: 8px;
        box-sizing: border-box;
        resize: none;
      }

      .note textarea {
        width: 100%;
        height: 90%;
        border: none;
        background: transparent;
        resize: none;
        font-family: inherit;
        font-size: 14px;
        outline: none;
      }

      .note .resizer {
        width: 16px;
        height: 16px;
        position: absolute;
        right: 2px;
        bottom: 2px;
        cursor: se-resize;
      }
    </style>
  </head>
  <body>
    <div class="noise"></div>
    <div id="sticker_canvas"></div>
    <button id="add_note">피드백 종이 만들기</button>

    <!-- GSAP Core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <!-- Draggable Plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>
    <!-- ScrollTrigger Plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <script>
      const canvas = document.getElementById("sticker_canvas");
      const addNoteBtn = document.getElementById("add_note");

      let currentZ = 1;

      addNoteBtn.addEventListener("click", () => {
        const note = document.createElement("div");
        note.className = "note";

        note.innerHTML = `
      <textarea placeholder="피드백을 입력하세요..."></textarea>
      <div class="resizer"></div>
    `;

        // 중앙 위치
        const canvasRect = canvas.getBoundingClientRect();
        const x = window.innerWidth / 2 + window.scrollX - canvasRect.left;
        const y = window.innerHeight / 2 + window.scrollY - canvasRect.top;

        note.style.left = `${x}px`;
        note.style.top = `${y}px`;
        note.style.transform = `translate(-50%, -50%)`;
        note.style.zIndex = currentZ++;

        canvas.appendChild(note);

        // 드래그 기능
        Draggable.create(note, {
          type: "x,y",
          inertia: true,
          allowEventDefault: true,
          onPress() {
            gsap.set(this.target, {
              x: gsap.getProperty(this.target, "x"),
              y: gsap.getProperty(this.target, "y"),
            });
            this.target.style.zIndex = ++currentZ;
          },
        });

        // 리사이즈 기능
        // makeResizable(note);
      });

      function makeResizable(note) {
        const resizer = note.querySelector(".resizer");

        let isResizing = false;

        resizer.addEventListener("mousedown", (e) => {
          isResizing = true;

          const startX = e.clientX;
          const startY = e.clientY;
          const startWidth = parseInt(
            document.defaultView.getComputedStyle(note).width,
            10
          );
          const startHeight = parseInt(
            document.defaultView.getComputedStyle(note).height,
            10
          );

          function doDrag(e) {
            if (!isResizing) return;

            note.style.width = `${startWidth + e.clientX - startX}px`;
            note.style.height = `${startHeight + e.clientY - startY}px`;
          }

          function stopDrag() {
            isResizing = false;
            window.removeEventListener("mousemove", doDrag);
            window.removeEventListener("mouseup", stopDrag);
          }

          window.addEventListener("mousemove", doDrag);
          window.addEventListener("mouseup", stopDrag);
        });
      }
    </script>
  </body>
</html>
