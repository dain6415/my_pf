<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
  box-sizing: border-box;
}

h1 {
  margin: 0;
}

.section {
  width: 100%;
  height: 100vh;
}

.accordion-section {
  width: 100%;
  background-color: #cccccc;
  border: 1px solid #ff1616;
}

/* .container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
} */

.item {
    width: 100%;
}

.header {
    width: 100%;
    padding: 1rem;
    color: white;
    border: 1px solid #000;
    background-color: rgb(40, 38, 38);
}

.body {
    /* overflow: hidden; */
    background-color: rgb(168, 137, 137);
    color: white;
    border: 3px solid #ff1616;
}

.content {
    padding: 1rem;
}

.content p {
  margin: 0;
  margin-bottom: 1rem;
}

.content p:last-child {
  margin: 0;
}
.gradient-red{
    background: #000;
    color: #fff;
    /* overflow: hidden; */
}
.gradient-purple{
    background: #512d2d;
}
    </style>
</head>
<body>
<div class="section gradient-blue"></div>
<div class="accordion-section">
  <div class="container">
    <div class="item">
      <div class="header gradient-green">
        <h1>ITEM ONE</h1>
      </div>
      <div class="body gradient-green">
        <div class="content">
          <p>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Tempore, quibusdam! Voluptates delectus aut blanditiis. Eaque possimus modi officia aspernatur sed, ab ipsam architecto non fugit dolorem et odit placeat labore! Animi sint temporibus nulla, ab laudantium, unde fugiat reiciendis at laborum voluptas tempore ex. Doloribus qui consectetur laboriosam error adipisci!</p>
          <p>Eum harum cum commodi voluptatibus! Quos incidunt necessitatibus at quam nulla accusantium praesentium perferendis enim, error quidem, libero nesciunt. Aperiam officia repudiandae odio mollitia possimus magnam, adipisci, perspiciatis dicta illo voluptatum quam ex, dolore cumque commodi exercitationem repellat. Ea quas beatae incidunt ducimus quidem nobis omnis sed error ipsa aperiam?</p>
          <p>Quia ex vitae ducimus consequatur odit modi. Ea, unde. Assumenda ratione, asperiores sequi dolore et impedit similique inventore incidunt qui quam sed dolorum id architecto, odit voluptatum! Corporis vitae architecto commodi nobis culpa cumque quod, inventore id ratione perspiciatis quam accusamus ipsum ducimus doloribus error consectetur similique laudantium, ullam sit!</p>
          <p>Architecto quae nobis excepturi aspernatur placeat ut temporibus eligendi, sapiente nesciunt deserunt, amet animi sint. Molestiae est et asperiores nulla tempore optio eligendi reiciendis, ipsam cum. Qui, temporibus ipsam adipisci magnam ratione cumque eius, nobis earum corrupti distinctio a? Quos cum, reprehenderit qui aliquam cupiditate consequuntur? Maxime, rem! Repudiandae, sequi?</p>
        </div>
      </div>
    </div>
    <div class="item">
      <div class="header gradient-green">
        <h1>ITEM TWO</h1>
      </div>
      <div class="body gradient-green">
        <div class="content">
          <p>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Tempore, quibusdam! Voluptates delectus aut blanditiis. Eaque possimus modi officia aspernatur sed, ab ipsam architecto non fugit dolorem et odit placeat labore! Animi sint temporibus nulla, ab laudantium, unde fugiat reiciendis at laborum voluptas tempore ex. Doloribus qui consectetur laboriosam error adipisci!</p>
          <p>Eum harum cum commodi voluptatibus! Quos incidunt necessitatibus at quam nulla accusantium praesentium perferendis enim, error quidem, libero nesciunt. Aperiam officia repudiandae odio mollitia possimus magnam, adipisci, perspiciatis dicta illo voluptatum quam ex, dolore cumque commodi exercitationem repellat. Ea quas beatae incidunt ducimus quidem nobis omnis sed error ipsa aperiam?</p>
          <p>Quia ex vitae ducimus consequatur odit modi. Ea, unde. Assumenda ratione, asperiores sequi dolore et impedit similique inventore incidunt qui quam sed dolorum id architecto, odit voluptatum! Corporis vitae architecto commodi nobis culpa cumque quod, inventore id ratione perspiciatis quam accusamus ipsum ducimus doloribus error consectetur similique laudantium, ullam sit!</p>
          <p>Architecto quae nobis excepturi aspernatur placeat ut temporibus eligendi, sapiente nesciunt deserunt, amet animi sint. Molestiae est et asperiores nulla tempore optio eligendi reiciendis, ipsam cum. Qui, temporibus ipsam adipisci magnam ratione cumque eius, nobis earum corrupti distinctio a? Quos cum, reprehenderit qui aliquam cupiditate consequuntur? Maxime, rem! Repudiandae, sequi?</p>
        </div>
      </div>
    </div>
    <div class="item">
      <div class="header gradient-green">
        <h1>ITEM 333333333</h1>
      </div>
      <div class="body gradient-green">
        <div class="content">
          <p>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Tempore, quibusdam! Voluptates delectus aut blanditiis. Eaque possimus modi officia aspernatur sed, ab ipsam architecto non fugit dolorem et odit placeat labore! Animi sint temporibus nulla, ab laudantium, unde fugiat reiciendis at laborum voluptas tempore ex. Doloribus qui consectetur laboriosam error adipisci!</p>
          <p>Eum harum cum commodi voluptatibus! Quos incidunt necessitatibus at quam nulla accusantium praesentium perferendis enim, error quidem, libero nesciunt. Aperiam officia repudiandae odio mollitia possimus magnam, adipisci, perspiciatis dicta illo voluptatum quam ex, dolore cumque commodi exercitationem repellat. Ea quas beatae incidunt ducimus quidem nobis omnis sed error ipsa aperiam?</p>
          <p>Quia ex vitae ducimus consequatur odit modi. Ea, unde. Assumenda ratione, asperiores sequi dolore et impedit similique inventore incidunt qui quam sed dolorum id architecto, odit voluptatum! Corporis vitae architecto commodi nobis culpa cumque quod, inventore id ratione perspiciatis quam accusamus ipsum ducimus doloribus error consectetur similique laudantium, ullam sit!</p>
          <p>Architecto quae nobis excepturi aspernatur placeat ut temporibus eligendi, sapiente nesciunt deserunt, amet animi sint. Molestiae est et asperiores nulla tempore optio eligendi reiciendis, ipsam cum. Qui, temporibus ipsam adipisci magnam ratione cumque eius, nobis earum corrupti distinctio a? Quos cum, reprehenderit qui aliquam cupiditate consequuntur? Maxime, rem! Repudiandae, sequi?</p>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="section final gradient-red">
    sdfsdfsdfsdfsfsdfsdfsdfsdfsdfsfsdfsdfsdfsdfsdfsd
</div>
<div class="section gradient-purple">

</div>



<script src="https://unpkg.co/gsap@3/dist/gsap.min.js"></script>
<script src="https://assets.codepen.io/16327/ScrollSmoother.min.js"></script>
<script src="https://unpkg.com/gsap@3/dist/ScrollTrigger.min.js"></script>
<script>
    console.clear();
  
    gsap.registerPlugin(ScrollTrigger);
  
    const items = gsap.utils.toArray(".item");
  
    const accordionSection = document.querySelector(".accordion-section");
  
    function updateAccordionHeight() {
      // 마지막 아코디언의 .body가 확장된 상태에서 높이 계산
      let totalHeight = 0;
      items.forEach((item) => {
        const body = item.querySelector(".body");
        const contentHeight = body.scrollHeight; // 실제 내용 높이
        totalHeight += contentHeight;
      });
  
      // .accordion-section 높이 설정
      accordionSection.style.height = totalHeight + "px";
    }
  
    // 아코디언 애니메이션 설정
    items.forEach((item, i) => {
      const content = item.querySelector(".body");
      const header = item.querySelector(".header");
  
      gsap.to(content, {
        height: "0 + .body",
        ease: "none",
        scrollTrigger: {
          trigger: item,
          start: "top " + header.clientHeight * i,
          endTrigger: ".final",
          
          end: "top " + header.clientHeight * items.length,
        //   end: "top " + header.clientHeight * items.length,
          pin: true,
          pinSpacing: false,
          scrub: true,
          markers: { indent: 150 * i },
          id: i + 1,
          onUpdate: updateAccordionHeight, // 높이 업데이트
        },
      });
    });
  
    // 초기 높이 설정
    updateAccordionHeight();
  </script>
  
</body>
</html>